title: Occupants
icon: mdi:account-group
views:
- title: Occupants
  type: panel
  cards:
  - type: custom:stack-in-card
    mode: vertical
    card_mod:
      style: |
        ha-card {
          background: transparent !important;
          box-shadow: none !important;
        }
    cards:

    # ── Household ──────────────────────────────────────
    - type: custom:bubble-card
      card_type: separator
      name: Household
      icon: mdi:home-account
      styles: |
        .bubble-line {
          background: rgba(255, 255, 255, 0.3) !important;
        }

    - type: horizontal-stack
      cards:

      # ── Sadat ──
      - type: custom:mushroom-template-card
        primary: Sadat
        secondary: >-
          {% set status = states('person.sadat_anwar') %}
          {% set ap = state_attr('device_tracker.iphone_8', 'connected_to') %}
          {% set battery = state_attr('device_tracker.sadats_iphone_15_olx', 'battery_level') %}
          {% if status == 'home' %}
            {%- if ap == 'fritz.box' %}1st Floor
            {%- elif ap == 'fritz-repeater-entrance' %}Ground Floor
            {%- elif ap == 'fritz-repeater-office' %}Top Floor
            {%- else %}Home
            {%- endif %}
          {%- else %}Away
          {%- endif %}
          {%- if battery is not none %} · {{ battery | int }}%{% endif %}
        icon: mdi:face-man
        icon_color: >-
          {{ 'blue' if states('person.sadat_anwar') == 'home' else 'disabled' }}
        entity: person.sadat_anwar
        tap_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: rgba(255, 255, 255, 0.1) !important;
              backdrop-filter: blur(10px);
              -webkit-backdrop-filter: blur(10px);
              border: 1px solid rgba(255, 255, 255, 0.2);
              border-radius: 16px;
              box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }

      # ── Aliza ──
      - type: custom:mushroom-template-card
        primary: Aliza
        secondary: >-
          {% set status = states('person.aliza') %}
          {% set ap = state_attr('device_tracker.pc_192_168_178_116', 'connected_to') %}
          {% set battery = state_attr('device_tracker.alizas_iphone', 'battery_level') %}
          {% if status == 'home' %}
            {%- if ap == 'fritz.box' %}1st Floor
            {%- elif ap == 'fritz-repeater-entrance' %}Ground Floor
            {%- elif ap == 'fritz-repeater-office' %}Top Floor
            {%- else %}Home
            {%- endif %}
          {%- else %}Away
          {%- endif %}
          {%- if battery is not none %} · {{ battery | int }}%{% endif %}
        icon: mdi:face-woman
        icon_color: >-
          {{ 'pink' if states('person.aliza') == 'home' else 'disabled' }}
        entity: person.aliza
        tap_action:
          action: more-info
        card_mod:
          style: |
            ha-card {
              background: rgba(255, 255, 255, 0.1) !important;
              backdrop-filter: blur(10px);
              -webkit-backdrop-filter: blur(10px);
              border: 1px solid rgba(255, 255, 255, 0.2);
              border-radius: 16px;
              box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            }

    # ── Guests ──────────────────────────────────────
    - type: custom:bubble-card
      card_type: separator
      name: Guests
      icon: mdi:account-group
      styles: |
        .bubble-line {
          background: rgba(255, 255, 255, 0.3) !important;
        }

    - type: markdown
      content: >
        {% set phone_kw = 'iphone|android|galaxy|samsung|pixel|mobile' %}
        {% set exclude = [
          'device_tracker.sadats_iphone_15_olx',
          'device_tracker.alizas_iphone',
          'device_tracker.iphone_2',
          'device_tracker.iphone_6',
          'device_tracker.iphone_8',
          'device_tracker.pc_192_168_178_116',
          'device_tracker.syed_sadats_ipad',
          'device_tracker.syed_sadats_ipad_2'
        ] %}
        {% set ns = namespace(entries=[]) %}
        {% for e in states.device_tracker | sort(attribute='attributes.friendly_name') %}
          {% set name = e.attributes.friendly_name | default(e.entity_id) %}
          {% if e.state == 'home'
             and e.entity_id not in exclude
             and state_attr(e.entity_id, 'source_type') == 'router'
             and (name | lower) is search(phone_kw) %}
            {% set ap = state_attr(e.entity_id, 'connected_to') | default('') %}
            {% if ap == 'fritz.box' %}{% set floor = '1st Floor' %}
            {% elif ap == 'fritz-repeater-entrance' %}{% set floor = 'Ground Floor' %}
            {% elif ap == 'fritz-repeater-office' %}{% set floor = 'Top Floor' %}
            {% else %}{% set floor = '' %}{% endif %}
            {% if floor %}
              {% set ns.entries = ns.entries + [name ~ ' · ' ~ floor] %}
            {% else %}
              {% set ns.entries = ns.entries + [name] %}
            {% endif %}
          {% endif %}
        {% endfor %}
        {% if ns.entries | length > 0 %}
        {% for entry in ns.entries %}
        {{ entry }}


        {% endfor %}
        {% else %}
        *No guest phones connected*
        {% endif %}
      card_mod:
        style: |
          ha-card {
            background: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
          }
